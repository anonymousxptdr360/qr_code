<meta charset="UTF-8">

  <title>Lecteur QR avec Actions</title>

  <style>

    body {

      margin: 0;

      font-family: 'Segoe UI', sans-serif;

      background-color: #f0f4fb;

      display: flex;

      height: 100vh;

    }

    .left-panel {

      width: 350px;

      background-color: #ffffff;

      border-right: 1px solid #ddd;

      display: flex;

      flex-direction: column;

      padding: 20px;

    }

    .tabs {

      display: flex;

      margin-bottom: 15px;

    }

    .tabs button {

      flex: 1;

      padding: 10px;

      border: none;

      cursor: pointer;

      background-color: #e7ecf5;

      border-radius: 6px 6px 0 0;

    }

    .tabs button.active {

      background-color: #fff;

      font-weight: bold;

    }

    .drop-zone {

      flex: 1;

      border: 2px dashed #ccc;

      border-radius: 8px;

      display: flex;

      flex-direction: column;

      align-items: center;

      justify-content: center;

      padding: 20px;

      text-align: center;

      color: #666;

      transition: background 0.3s;

    }

    .drop-zone.dragover {

      background-color: #eef5ff;

      border-color: #3390ff;

    }

    .drop-zone input {

      display: none;

    }

    .drop-zone img {

      width: 50px;

      margin-bottom: 10px;

      opacity: 0.5;

    }

    .right-panel {

      flex: 1;

      display: flex;

      flex-direction: column;

      align-items: center;

      justify-content: center;

      padding: 20px;

      background: #ffffff;

      position: relative;

    }

    .right-panel img.preview {

      max-width: 300px;

      margin-bottom: 20px;

    }

    .output-box {

      padding: 15px;

      border: 1px solid #ccc;

      border-radius: 6px;

      background-color: #fafafa;

      min-height: 50px;

      max-width: 80%;

      text-align: center;

    }

    .output-box.url { border-left: 5px solid #4caf50; }

    .output-box.text { border-left: 5px solid #f44336; }

    .output-box[data-type="text"] {

      cursor: pointer;

    }

    #copied-message {

      color: green;

      font-weight: bold;

      margin-top: 10px;

    }

    .controls button {

      margin: 8px;

      padding: 5px 12px;

      background: #3390ff;

      color: white;

      border: none;

      border-radius: 4px;

      cursor: pointer;

    }

    video {

      width: 300px;

      border: 1px solid #ccc;

      border-radius: 6px;

      margin-top: 10px;

    }

  </style>





  <div class="left-panel">

    <div class="tabs">

      <button class="active" onclick="activateTab('upload')">T√©l√©charger</button>

      <button onclick="activateTab('camera')">Scanner le code QR</button>

    </div>

    <div id="upload-panel" class="drop-zone" ondragover="event.preventDefault(); this.classList.add('dragover')" ondragleave="this.classList.remove('dragover')" ondrop="handleDrop(event)">

      <img src="https://img.icons8.com/ios/50/image.png" alt="Image" loading="lazy">

      <p>T√©l√©chargez vos fichiers / Collez (Ctrl + V)</p>

      <input type="file" accept="image/*" onchange="handleImageUpload(event)" id="file-input">

      <label for="file-input" style="margin-top:10px;cursor:pointer;background:#3390ff;color:#fff;padding:6px 15px;border-radius:4px;">T√©l√©charger üì§</label>

    </div>

    <div id="camera-panel" class="drop-zone" style="display:none">

      <p>Cam√©ra en cours...</p>

      <video id="video" autoplay=""></video>

    </div>

  </div>



  <div class="right-panel">

    <div id="preview-container">

      <img id="preview" class="preview" style="display:none" loading="lazy">

    </div>

    <div id="output" class="output-box" onclick="copyIfText()" data-type="none">En Attente de la Num√©risation d‚Äôun √âl√©ment...</div>

    <div id="controls" class="controls"></div>

    <div id="copied-message"></div>

  </div>



  <script src="https://unpkg.com/jsqr/dist/jsQR.js"></script>

  <script>

    let lastScanned = '';



    function activateTab(tab) {

      document.querySelectorAll('.tabs button').forEach(btn => btn.classList.remove('active'));

      document.querySelectorAll('.drop-zone').forEach(el => el.style.display = 'none');

      document.getElementById(tab + '-panel').style.display = 'flex';

      document.querySelector(`.tabs button[onclick*='${tab}']`).classList.add('active');

      if (tab === 'camera') startCameraScan();

    }



    function handleImageUpload(event) {

      const file = event.target.files[0];

      if (file) processFile(file);

    }



    function handleDrop(event) {

      event.preventDefault();

      const file = event.dataTransfer.files[0];

      if (file) processFile(file);

    }



    function processFile(file) {

      const reader = new FileReader();

      reader.onload = function(e) {

        const img = new Image();

        img.onload = function() {

          document.getElementById('preview').src = img.src;

          document.getElementById('preview').style.display = 'block';

          const canvas = document.createElement('canvas');

          canvas.width = img.width;

          canvas.height = img.height;

          const ctx = canvas.getContext('2d');

          ctx.drawImage(img, 0, 0);

          const imageData = ctx.getImageData(0, 0, canvas.width, canvas.height);

          const code = jsQR(imageData.data, canvas.width, canvas.height);

          showResult(code ? code.data : null);

        };

        img.src = e.target.result;

      };

      reader.readAsDataURL(file);

    }



    function startCameraScan() {

      const video = document.getElementById('video');

      navigator.mediaDevices.getUserMedia({ video: { facingMode: 'environment' } })

        .then(stream => {

          video.srcObject = stream;

          const canvas = document.createElement('canvas');

          const ctx = canvas.getContext('2d');



          function tick() {

            if (video.readyState === video.HAVE_ENOUGH_DATA) {

              canvas.width = video.videoWidth;

              canvas.height = video.videoHeight;

              ctx.drawImage(video, 0, 0);

              const imageData = ctx.getImageData(0, 0, canvas.width, canvas.height);

              const code = jsQR(imageData.data, canvas.width, canvas.height);

              if (code) {

                showResult(code.data);

                stream.getTracks().forEach(track => track.stop());

                return;

              }

            }

            requestAnimationFrame(tick);

          }

          requestAnimationFrame(tick);

        })

        .catch(err => alert('Erreur cam√©ra : ' + err));

    }



    function showResult(data) {

      const output = document.getElementById('output');

      const controls = document.getElementById('controls');

      const copied = document.getElementById('copied-message');

      controls.innerHTML = '';

      copied.innerText = '';



      if (!data) {

        output.innerText = "QR code non d√©tect√©.";

        output.className = 'output-box';

        output.dataset.type = 'none';

        return;

      }

      lastScanned = data;

      output.innerText = data;



      const isLikelyURL = data.includes('.') && !data.includes(' ');

      const url = (data.startsWith('http://') || data.startsWith('https://')) ? data : `https://${data}`;



      if (isLikelyURL) {

        output.className = 'output-box url';

        output.dataset.type = 'url';

        controls.innerHTML = `

          <button onclick="window.open('${url}', '_blank')">Aller au lien</button>

          <button onclick="copyText('${url}')">Copier</button>

          <button onclick="copyText('${url}'); window.open('${url}', '_blank')">Copier + Ouvrir</button>

        `;

      } else {

        output.className = 'output-box text';

        output.dataset.type = 'text';

        controls.innerHTML = `<button onclick="copyText('${data}')">Copier le texte</button>`;

      }

    }



    function copyText(text) {

      navigator.clipboard.writeText(text).then(() => {

        const msg = document.getElementById('copied-message');

        msg.innerText = 'Contenu copi√© !';

        setTimeout(() => msg.innerText = '', 2000);

      });

    }



    function copyIfText() {

      const output = document.getElementById('output');

      if (output.dataset.type === 'text') {

        copyText(lastScanned);

      }

    }

  </script>
